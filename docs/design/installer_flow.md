# Webインストーラー フロー設計書

## 1. 設計思想

*   `specification.md` の要件に基づき、**コマンドライン操作を一切不要**とし、ブラウザ上のGUI操作のみでアプリケーションのインストールを完結させることを目指します。
*   実績のあるOSSパッケージ `rashidulhasan/laravel-installer` を活用し、堅牢で分かりやすいインストール体験を提供します。
*   各ステップでユーザーに必要な情報を明確に伝え、エラーが発生した場合はその原因と対処法を分かりやすく提示します。

## 2. インストールフロー

ユーザーがアプリケーションのURLに初めてアクセスすると、インストール済みかどうかを判定し、未インストールの場合は `/install` にリダイレクトされます。

### ステップ1: Web設定ページ

*   **URL:** `/install`
*   **表示内容:**
    1.  **サーバー要件チェック:**
        *   PHPのバージョンや必須拡張機能の充足状況を自動的にチェックし、結果を表示します。問題がある場合は、ここで処理が停止し、エラーメッセージが表示されます。
    2.  **ディレクトリ権限チェック:**
        *   `storage` や `bootstrap/cache` などのディレクトリ権限を自動的にチェックし、結果を表示します。問題がある場合は、ここで処理が停止し、エラーメッセージが表示されます。
    3.  **データベース設定:**
        *   データベース接続情報を入力するフォーム。
    4.  **管理者アカウント作成:**
        *   最初の管理者となるユーザーのアカウント情報（名前、メールアドレス、パスワード）を入力するフォーム。
    5.  **インストール実行ボタン:**
        *   すべてのチェックが完了し、フォームが入力されると有効になります。
*   **内部処理（「インストール実行」ボタン押下後）:**
    1.  入力された情報を元に `.env` ファイルを生成します。
    2.  システム固有の識別子 (UUID) を生成し、`.env` ファイルに追記します。
    3.  データベースマイグレーションを実行します (`php artisan migrate`)。
    4.  入力された情報で管理者アカウントを作成します。
    5.  インストールが完了したことを示すフラグファイル（例: `storage/installed`）を作成します。
*   **分岐:**
    *   すべての処理が成功した場合、「インストール完了」ページにリダイレクトします。
    *   処理中にエラーが発生した場合（例: データベース接続失敗）、エラーメッセージをページに表示します。

### ステップ2: 完了ページ

*   **URL:** `/install/complete`
*   **表示内容:**
    *   「インストールが完了しました！」というメッセージ。
    *   アプリケーションのログインページへのリンクボタン。
